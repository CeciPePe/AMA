---
title: "DensityEstimationGMMDBSCAN"
output: html_document
date: "2023-10-04"
---

## Read libraries we need
```{r}
library(mclust)
library(sm)
library(fpc)
```
## Load the data: 
```{r}
load("BikeDay.Rdata")
X <- as.matrix(day[day$yr==1,c(10,14)])
```


## Exercice 1:
```{r}
GMM_BIC <- Mclust(X,G=2:6,modelNames = "VVV")
par(mfrow= c(2,2))
plot(GMM_BIC, what = "BIC")
title("BIC")
plot(GMM_BIC, what = "classification")
title("Classification")
plot(GMM_BIC, what = "uncertainty")
title("Uncertanty")
plot(GMM_BIC, what = "density")
title("Density")
```
  
On this plots, we can see the results for the Gaussian Mixture Models, where we see that the highest BIC, when the varying volume, shape, and orientation, is for 3 clusters. Looking at the classification plot, we can see that the blue and red clusters look very close.

## Exercise 2: 
```{r}
a <- 0.25
sm.density(x = X, h = a*c(sd(X[,1]),sd(X[,2])), display = 'slice')

```
  
Comparing this plot with the previous density plot, we can see that the top part of the plot, the green cluster, is not seen when the non-parametric density estimation is used. Looking further, we can see that using this second-density estimation, it probably estimates 2 clusters, compared to the three estimated by the parametric.  

## Exercise 3

```{r}
k <- 3
a <- 0.4
clust.ind <- GMM_BIC$classification
plot(X,col=clust.ind)
for (j in 1:k){
  cl.j <- (clust.ind==j)
  sm.density(X[cl.j,],h=a*c(sd(X[,1]),sd(X[,2])), 
             display="slice",props=c(75),
             col=j, cex=4, add=TRUE)
}

```

## Exercise 4

```{r}
mnx <- mergenormals(X,GMM_BIC,method="bhat")
summary(mnx)
```
```{r}
k<-2
plot(X,col=mnx$clustering)
```
Looking at the results from the mergenormals function, we can see that the red and the blue clusters from the first exercise are merged into one cluster, this are the ones corresponding to cluster 1 and cluster 2. 

## Exercise 5

```{r}

k=2
a=0.4
h=a*c(sd(X[,1]),sd(X[,2]))
plot(X,col=mnx$clustering)
clust.ind <- mnx$clustering

for (j in 1:k){
  cl.j <- (clust.ind==j)
  sm.density(X[cl.j,],h=h, 
             display="slice",props=c(75),
             col=j, cex=4, add=TRUE)
}


```
## Exercise 6

```{r}
epsilon=c(0.25,0.5)
minPts=c(10,15,20)

Xs <- scale(X)

par(mfrow=c(2,3))
for(eps in epsilon)
{
  for (mP in minPts)
  {
    dbscan.ds <- dbscan::dbscan(Xs,eps = eps, minPts = mP)
plot(X, col=dbscan.ds$cluster+1, pch=dbscan.ds$cluster+1, 
     main=paste("eps=",eps,",minPts=",mP),
     xlab="temp",ylab="casual")
  }
}

db = dbscan::dbscan(Xs,eps = 0.5, minPts = 20)
table(db$cluster+1,mnx$clustering)
```
We consider that the best representation is given by the dbscan when the epsilon is set at 0.5 and the minpoints are set at 20. This cluster gives a clear separation of the 2 clusters, and it separates it into 2 different clusters. Comparing it to the mergecluster results we can see that both separate the observations into the same cluster with the exception of 1 observation. 


## Exercise 7

```{r}
GMM.c1 = which(GMM_BIC$classification==1) 
GMM.c2 = which(GMM_BIC$classification==2)
GMM.c3 = which(GMM_BIC$classification==3)
summary(day[GMM.c1,])
summary(day[GMM.c2,])
summary(day[GMM.c3,])
```

Looking at the summary of the three different clusters generated by the GMM, we can see that the season for clusters 2 and 3 has a media at 3 (fall), and on the other hand, cluster 1 has a median of 1 (spring). Regarding the year, we can see it's mostly 0, so 2011 in all the clusters, but cluster 1 has some observations that are from year 1. Moving on, to the month we can see that for cluster 1, the median is 3 (march), and clusters 2 and 3 ave a median of month 7 and 6.5 respectively. Next, on the weekday we can see that cluster 1 has a median of Tuesday, cluster 2 has a median of Wednesday and Cluster 3 has a median of Friday. Regarding clusters 1 and 2, we can see a majority of working days, on the other hand, cluster 3 has a majority of not working days. Looking at the weathersit variable, we can see for all clusters it's mostly 1 (Clear, Few clouds, Partly cloudy, Partly cloudy), we can see also that in none of the clusters, there is weathersit 4. Next, we have the temp, one of the variables used for the clustering, we can see that the mean of clusters 2 and 3 are very close, this being 0.5688 and 0.5573, on the other hand, cluster 1 has a lower normalized temperature of 0.30321, we can see the same happening with the atemp, which is the normalized filling temperature. Moving on we have the humidity, which is more or less the same for all clusters, the same thing for the windspeed. Next, we have the casual, which is the other variable used for the clustering, this is the count of rental bikes by user registered, we can see that are clusters are more or less equally separated, by around 400, moving on to the registered, we can see that clusters 2 and 3 have a close value of registered rental bikes, compared to cluster 1 has a much lower value. Lastly, cnt, the total amount of rental bikes, we can see that cluster 1 has a much lower number, 2183 compared to cluster 2 and 3, which is 3889 and 4080 respectively.

```{r}
db.c1 = which(db$cluster==0) 
db.c2 = which(db$cluster==1)

summary(day[db.c1,])
summary(day[db.c2,])

```

Looking at the clusters generated by the dbscan and the mergausians, we can see we are keeping the previous cluster 3, but we merged clusters 1 and 2. Only one cluster changed, we will only explain that cluster, so to start of, we can see that this cluster has most of its observations in the summer, regarding the year, same as before, most of the observations were observed in 2011. and the month is July, and regarding weekdays we see that most of them were on Tuesdays. Looking at the working day, we see that most of the observations were on working days. Regarding the weathersit we see the same as before, most of them being 1, with no 4, looking at the temperature we can see an average temperature of around 0.47, and an atemp of 0.45496. Looking at the humidity, this new cluster has a humidity of 0.64 and a windspeed of 0.19. Lastly, the casual for this new cluster is 594, a registered of 2680, and a total average of 3275. 

